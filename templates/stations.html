<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Station Management | SSMS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stations.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
{% extends "base.html" %}
{% block content %}

    <div class="container">
        <header>
            {% if role == 'admin' %}
            <h1><i class="fas fa-broadcast-tower"></i> Station Management</h1>
            {% else %}
            <h1><i class=""></i> View Stations and Connect </h1>
            {% endif %}
        </header>

        <nav class="station-nav">
            <ul>

                    {% if role == 'admin' %}
                        <li class="active" data-section="register"><a href="#register"><i class="fas fa-plus-circle"></i>Register</a></li>
                        <li data-section="manage"><a href="#manage"><i class="fas fa-tasks"></i> Manage</a></li>
                    {% endif %}

                    <!-- {% if role == 'supporter' %}
                    <li data-section="view"><a href="#view"><i class="fas fa-search"></i> View</a></li>
                    {% endif %} -->
            </ul>
        </nav>

    {% if role == 'admin' %}
        <div class="content-section" id="register-section">
            <h2><i class="fas fa-plus-circle"></i> Register New Station</h2>
            <div class="form-container">
                <form id="station-form" action="{{ url_for('add_station') }}" method="POST">
                    <div class="form-group">
                        <label for="station_code">Station Code</label>
                        <input type="text" name="station_code" id="station_code" placeholder="Enter station code" required>
                    </div>
                    <div class="form-group">
                        <label for="station_name">Station Name</label>
                        <input type="text" name="station_name" id="station_name" placeholder="Enter station name" required>
                    </div>
                    <div class="form-group">
                        <label for="group_id">Group</label>
                        <select name="group_id" id="group_id" required>
                            {% for g in groups %}
                            <option value="{{g.id}}">{{ g.group_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="region_id">Region</label>
                        <select name="region_id" id="region_id" required>
                            <option value="">Select Region</option>
                            {% for r in regions %}
                            <option value="{{ r.id }}">{{ r.region_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="location">District</label>
                        <select name="location" id="location" required>
                            <option value="">Select District</option>
                            {% for d in districts %}
                            <option value="{{d.id}}" data-region="{{d.region_id}}">{{ d.district_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="contact_name">Contact Name</label>
                        <input type="text" name="contact_name" id="contact_name" placeholder="Enter contact name" required>
                    </div>
                    <div class="form-group">
                        <label for="contact_number">Contact Number</label>
                        <input type="text" name="contact_number" id="contact_number" placeholder="Enter contact number" required>
                    </div>
                    <div class="form-group">
                        <label for="connect_IP_Address">IP Address</label>
                        <input type="text" name="connect_IP_Address" id="connect_IP_Address" placeholder="Enter IP address">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Register Station</button>
                        <button type="reset" class="btn-secondary">Clear Form</button>
                    </div>
                </form>

                <div class="form-preview">
                    <h3>Preview</h3>
                    <div class="preview-card">
                        <div class="preview-header">
                            <i class="fas fa-broadcast-tower"></i>
                            <h4 id="preview-Sname">New Station</h4>
                        </div>
                        <div class="preview-body">
                            <p><strong>Station Name:</strong> <span id="preview-name">-</span></p>
                            <p><strong>Region:</strong> <span id="preview-region">-</span></p>
                            <p><strong>District:</strong> <span id="preview-district">-</span></p>
                            <p><strong>Group:</strong> <span id="preview-group">-</span></p>
                            <p><strong>Contact Name:</strong> <span id="preview-contact-name">-</span></p>
                            <p><strong>Contact Number:</strong> <span id="preview-contact-number">-</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="content-section" id="manage-section" {% if role == 'admin' %} style="display: none;" {% endif %}>
            <h2><i class="fas fa-tasks"></i> {% if role == 'admin' %}Manage Stations{% else %}Stations{% endif %}</h2>
            <div class="management-tools">
                <div class="search-filter">
                    <input type="text" placeholder="Search stations..." id="station-search">
                    <select id="filter-region">
                        <option value="">All Regions</option>
                    </select>
                    {% if role == 'admin' %}
                    <button class="btn-secondary btn-export" style="margin-left:10px;"><i class="fas fa-download"></i> Export</button>
                    {% endif %}
                </div>

                <div class="pagination-controls">
                    <span>Show:</span>
                    <select id="items-per-page">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                    </select>
                    <span>items per page</span>
                </div>
            </div>

            <div class="stations-table-container">
                <table id="stations-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Station Code</th>
                            <th>Station Name</th>
                            <th>Group</th>
                            <th>District</th>
                            <th>Contact Name</th>
                            <th>Contact Number</th>
                            <th>IP Address</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic rows will be inserted here by JS -->
                    </tbody>
                </table>

                <div class="table-pagination">
                    <div class="table-pagination">
                        <button class="btn-secondary" id="prev-page"><i class="fas fa-chevron-left"></i> Previous</button>
                        <span id="page-indicator">Page 1 of 5</span>
                        <button class="btn-secondary" id="next-page">Next <i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>

                
                <div class="station-details">
                    <div class="detail-card">
                        <div class="detail-header">
                            <i class="fas fa-broadcast-tower"></i>
                            <h3 id="station-detail-title">No station selected</h3>
                        </div>
                        <div class="detail-body" id="station-detail-body">
                            <div class="detail-row">
                                <span class="detail-label">Station Code:</span>
                                <span class="detail-value">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Region:</span>
                                <span class="detail-value">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">District:</span>
                                <span class="detail-value">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">IP Address:</span>
                                <span class="detail-value">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Status:</span>
                                <span class="detail-value status-active">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Last Updated:</span>
                                <span class="detail-value">-</span>
                            </div>
                            <div class="detail-row full-width">
                                <span class="detail-label">Contact:</span>
                                <span class="detail-value">-</span>
                            </div>
                            <div id="station-detail-message" style="text-align:center;color:#888;margin-top:1em;">No details available. Select a station to view details.</div>
                        </div>
                        <div class="detail-actions">
                                {% if role == 'admin' %}
                                    <button class="btn-primary"><i class="fas fa-edit"></i> Edit</button>
                                    <button class="btn-secondary"><i class="fas fa-chart-line"></i> Statistics</button>
                                {% endif %}
                                <button class="btn-connect"><i class="fas fa-plug"></i> Connect</button>
                        </div>
                    </div>
                    <div class="station-map">
                        <div class="map-placeholder">
                            <i class="fas fa-map-marked-alt"></i>
                            <p>Station Location Map</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-section" id="connect-section" style="display: none;">
            <h2><i class="fas fa-plug"></i> Connect to Station</h2>
            <div class="connect-container">
                <div class="connection-controls">
                    <div class="connection-input">
                        <input type="text" placeholder="Enter station URL or ID" id="station-connect">
                        <button class="btn-primary" id="connect-btn"><i class="fas fa-link"></i> Connect</button>
                    </div>

                    <div class="connection-status">
                        <div class="status-indicator">
                            <div class="indicator-circle"></div>
                            <span>Connection Status: <strong>Disconnected</strong></span>
                        </div>
                        <div class="connection-stats">
                            <div class="stat-item">
                                <span class="stat-label">Latency:</span>
                                <span class="stat-value">- ms</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Uptime:</span>
                                <span class="stat-value">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="connection-actions">
                    <button class="btn-secondary"><i class="fas fa-cog"></i> Settings</button>
                    <button class="btn-secondary"><i class="fas fa-history"></i> Logs</button>
                    <button class="btn-primary"><i class="fas fa-download"></i> Download Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Station Details & Connect Modal -->
<div class="modal fade" id="stationModal" tabindex="-1" aria-labelledby="stationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="stationModalLabel"><i class="fas fa-broadcast-tower"></i> Station Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <!-- Left: Details -->
          <div class="col-md-7">
            <div class="detail-body">
              <p><strong>Station Code:</strong> <span id="detail-station-code">-</span></p>
              <p><strong>Name:</strong> <span id="detail-station-name">-</span></p>
              <p><strong>Region:</strong> <span id="detail-region">-</span></p>
              <p><strong>District:</strong> <span id="detail-district">-</span></p>
              <p><strong>IP Address:</strong> <span id="detail-ip">-</span></p>
              <p><strong>Contact:</strong> <span id="detail-contact">-</span></p>
            </div>
          </div>
          
          <!-- Right: Connect -->
          <div class="col-md-5 border-start">
            <h6><i class="fas fa-plug"></i> Connect</h6>
            <input type="text" class="form-control mb-2" id="station-connect" placeholder="Enter IP or Station ID">
            <button class="btn btn-primary w-100 mb-2" id="connect-btn">
              <i class="fas fa-link"></i> Connect
            </button>
            <div class="connection-status">
              <div class="status-indicator">
                <div class="indicator-circle"></div>
                <span>Status: <strong id="connection-status">Disconnected</strong></span>
              </div>
              <p><small>Latency: <span id="latency">-</span></small></p>
              <p><small>Uptime: <span id="uptime">-</span></small></p>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        {% if role == 'admin' %}
          <button class="btn btn-secondary" id="edit-btn"><i class="fas fa-edit"></i> Edit</button>
        {% endif %}
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

    <input type="hidden" id="user-role" value="{{ role }}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/station.js')}}"></script>
{% endblock %}

</body>

</html>